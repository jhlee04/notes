import os
import win32com.client
import pandas as pd

# ë¶„ì„ ëŒ€ìƒ í´ë” ì„¤ì •
pptx_folder = r"C:\path\to\your\pptx_files"

# ì¶”ì¶œí•  ì…€ ìœ„ì¹˜ ë° ë ˆì´ë¸” ë§¤í•‘
target_cells = {
    (1, 2): "ê³¼ì œëª…",
    (2, 2): "ë‹´ë‹¹ì",
    (2, 5): "ê¸°ê°„",
    (3, 2): "ëª©ì ",
    (5, 2): "ë°°ê²½ í•„ìš”ì„±",
    (5, 4): "huddle",
    (7, 2): "í˜„ì¬ ì§€í‘œ",
    (7, 3): "ê°œì„  ì§€í‘œ"
}

# ê²°ê³¼ ì €ì¥ ë¦¬ìŠ¤íŠ¸
results = []

# PowerPoint ì‹¤í–‰
ppt_app = win32com.client.Dispatch("PowerPoint.Application")
ppt_app.Visible = False

# PPTX íŒŒì¼ ìˆœíšŒ
for filename in os.listdir(pptx_folder):
    if filename.endswith(".pptx"):
        filepath = os.path.join(pptx_folder, filename)
        print(f"ğŸ“‚ Processing: {filename}")
        try:
            # í”„ë ˆì  í…Œì´ì…˜ ì—´ê¸°
            presentation = ppt_app.Presentations.Open(filepath, WithWindow=False)

            # ìŠ¬ë¼ì´ë“œ 2ë§Œ ëŒ€ìƒ
            slide = presentation.Slides(2)

            # ê²°ê³¼ ì €ì¥ìš© dict
            row_data = {"íŒŒì¼ëª…": filename}

            # í…Œì´ë¸” ì°¾ê¸°
            table_found = False
            for shape in slide.Shapes:
                if shape.HasTable:
                    table = shape.Table
                    table_found = True
                    for (row, col), label in target_cells.items():
                        try:
                            cell = table.Cell(row, col).Shape.TextFrame.TextRange
                            full_text = ""
                            for i in range(1, cell.Paragraphs().Count + 1):
                                para_text = cell.Paragraphs(i).Text
                                full_text += para_text.strip() + " "
                            row_data[label] = full_text.strip()
                        except Exception as e:
                            row_data[label] = f"(ì˜¤ë¥˜: {e})"
                    break  # ì²« í…Œì´ë¸”ë§Œ ì‚¬ìš©

            if not table_found:
                for label in target_cells.values():
                    row_data[label] = "(í‘œ ì—†ìŒ)"

            results.append(row_data)
            presentation.Close()

        except Exception as e:
            print(f"âŒ Error in {filename}: {e}")

# PowerPoint ì¢…ë£Œ
ppt_app.Quit()

# DataFrame ìƒì„±
df = pd.DataFrame(results)

# ê²°ê³¼ í™•ì¸
print(df.head())

# íŒŒì¼ë¡œ ì €ì¥
output_path = os.path.join(pptx_folder, "pptx_ìš”ì•½_ê²°ê³¼.xlsx")
df.to_excel(output_path, index=False)
print(f"âœ… ê²°ê³¼ ì €ì¥ ì™„ë£Œ: {output_path}")
